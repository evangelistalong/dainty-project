<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Dainty - Branch</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    *{-webkit-tap-highlight-color:transparent;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;margin:0;background:#f5f5f5}
    input,select,button,textarea{font-size:16px!important}
    .spin{animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .fade{animation:fade .2s ease-in}
    @keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .card{background:#fff;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,.08);overflow:hidden}
    .btn{border:none;border-radius:10px;padding:12px 20px;font-weight:600;cursor:pointer;transition:all .2s}
    .btn-p{background:linear-gradient(135deg,#dc2626,#b91c1c);color:#fff}
    .btn-s{background:#f3f4f6;color:#374151}
    .btn-sm{padding:8px 12px;font-size:13px}
    .inp{width:100%;border:1px solid #e5e7eb;border-radius:10px;padding:12px;background:#fff}
    .inp:focus{outline:none;border-color:#b91c1c;box-shadow:0 0 0 3px rgba(185,28,28,.1)}
    .lbl{font-size:12px;color:#6b7280;font-weight:500;display:block;margin-bottom:4px}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë  BRANCH CONFIGURATION - CHANGE THESE FOR EACH BRANCH       ‚ïë
// ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
// ‚ïë  Copy this file and change only these 2 lines:             ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

const BRANCH_CODE = 'DSMC';
const BRANCH_NAME = 'Dainty SM Clark';

// Optional: Hardcode API URL (leave empty to prompt user)
const API_URL = 'https://script.google.com/macros/s/AKfycbxqSdXxqCna9TvELBaN-SBR-4xTIFU8duQF3KYBq14UTjJBF_ORGUWYZZy86pH-59Iv0Q/exec';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DO NOT EDIT BELOW THIS LINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const{useState,useEffect,useCallback}=React;

async function api(url,action,params={}){
  if(!url)throw new Error('API URL not set');
  const u=new URL(url);
  u.searchParams.set('action',action);
  Object.entries(params).forEach(([k,v])=>{if(v!=null)u.searchParams.set(k,typeof v==='object'?JSON.stringify(v):v)});
  const r=await fetch(u.toString());
  const d=await r.json();
  if(d.error)throw new Error(d.error);
  return d;
}

const fmt=n=>'‚Ç±'+(parseFloat(n)||0).toLocaleString('en-PH',{minimumFractionDigits:2,maximumFractionDigits:2});
const fmtDate=d=>d?new Date(d).toLocaleDateString('en-PH',{month:'short',day:'numeric'}):'-';

function App(){
  const[apiUrl,setApiUrl]=useState(API_URL||localStorage.getItem('dainty_api')||'');
  const[password,setPassword]=useState('');
  const[authenticated,setAuthenticated]=useState(false);
  const[ready,setReady]=useState(false);
  const[tab,setTab]=useState('purchases');
  const[loading,setLoading]=useState(false);
  const[toast,setToast]=useState(null);
  const[settings,setSettings]=useState({});
  const[ingredients,setIngredients]=useState([]);
  const[ingCats,setIngCats]=useState([]);
  const[purchases,setPurchases]=useState([]);
  const[expenses,setExpenses]=useState([]);
  const[loginError,setLoginError]=useState('');
  const[viewDays,setViewDays]=useState(0); // 0 = today only

  const showToast=(msg,type='success')=>{setToast({msg,type});setTimeout(()=>setToast(null),3000)};

  const checkSavedAuth=useCallback(async()=>{
    const savedUrl=API_URL||localStorage.getItem('dainty_api');
    const savedAuth=localStorage.getItem('dainty_auth_'+BRANCH_CODE);
    if(savedUrl&&savedAuth){
      try{
        const r=await api(savedUrl,'verifyBranchPassword',{branchCode:BRANCH_CODE,password:savedAuth});
        if(r.success){
          setApiUrl(savedUrl);
          setAuthenticated(true);
          setReady(true);
          return true;
        }
      }catch(e){console.error(e)}
    }
    return false;
  },[]);

  useEffect(()=>{checkSavedAuth()},[checkSavedAuth]);

  const login=async()=>{
    if(!apiUrl){setLoginError('Enter database URL');return}
    if(!password){setLoginError('Enter password');return}
    setLoading(true);
    setLoginError('');
    try{
      const r=await api(apiUrl,'verifyBranchPassword',{branchCode:BRANCH_CODE,password});
      if(r.success){
        localStorage.setItem('dainty_api',apiUrl);
        localStorage.setItem('dainty_auth_'+BRANCH_CODE,password);
        setAuthenticated(true);
        setReady(true);
      }else{
        setLoginError(r.error||'Login failed');
      }
    }catch(e){setLoginError(e.message)}
    finally{setLoading(false)}
  };

  const logout=()=>{
    localStorage.removeItem('dainty_auth_'+BRANCH_CODE);
    setAuthenticated(false);
    setReady(false);
    setPassword('');
  };

  const loadAll=useCallback(async()=>{
    if(!apiUrl)return;
    setLoading(true);
    try{
      const[s,i,ic]=await Promise.all([
        api(apiUrl,'getSettings'),
        api(apiUrl,'getIngredients'),
        api(apiUrl,'getIngredientCategories')
      ]);
      setSettings(s.settings||{});
      setIngredients(i.ingredients||[]);
      setIngCats(ic.categories||[]);
    }catch(e){showToast(e.message,'error')}
    finally{setLoading(false)}
  },[apiUrl]);

  const loadTx=useCallback(async(days=0)=>{
    if(!apiUrl)return;
    try{
      const[p,e]=await Promise.all([
        api(apiUrl,'getPurchases',{branch:BRANCH_NAME,days:days||30}),
        api(apiUrl,'getExpenses',{branch:BRANCH_NAME,days:days||30})
      ]);
      const today=new Date().toISOString().split('T')[0];
      const cutoff=days===0?today:new Date(Date.now()-days*24*60*60*1000).toISOString().split('T')[0];
      setPurchases((p.purchases||[]).filter(x=>days===0?x.PurchaseDate===today:x.PurchaseDate>=cutoff));
      setExpenses((e.expenses||[]).filter(x=>days===0?x.Date===today:x.Date>=cutoff));
    }catch(e){console.error(e)}
  },[apiUrl]);

  useEffect(()=>{if(ready)loadAll()},[ready,loadAll]);
  useEffect(()=>{if(ready)loadTx(viewDays)},[ready,loadTx,viewDays]);

  // Login Screen
  if(!ready||!authenticated)return(
    <div className="min-h-screen flex items-center justify-center p-4" style={{background:'linear-gradient(135deg,#b91c1c,#7f1d1d)'}}>
      <div className="card p-8 max-w-md w-full fade">
        <div className="text-center mb-6">
          <div className="text-6xl mb-4">üçú</div>
          <h1 className="text-2xl font-bold text-gray-800">{BRANCH_NAME}</h1>
          <p className="text-gray-500 text-sm mt-1">{BRANCH_CODE}</p>
        </div>
        
        {!API_URL&&<div className="mb-4">
          <label className="lbl">Database URL</label>
          <input value={apiUrl} onChange={e=>setApiUrl(e.target.value)} placeholder="Paste URL from admin" className="inp"/>
        </div>}
        
        <div className="mb-4">
          <label className="lbl">Branch Password</label>
          <input type="password" value={password} onChange={e=>setPassword(e.target.value)} onKeyDown={e=>e.key==='Enter'&&login()} placeholder="Enter password" className="inp"/>
        </div>
        
        {loginError&&<p className="text-red-600 text-sm mb-4 text-center">{loginError}</p>}
        
        <button onClick={login} disabled={loading} className="btn btn-p w-full">
          {loading?<span className="flex items-center justify-center gap-2"><span className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full spin"/>Checking...</span>:'üîê Login'}
        </button>
        
        <p className="text-xs text-gray-400 text-center mt-4">Ask admin for password</p>
      </div>
    </div>
  );

  const todayPurchases=purchases.filter(p=>p.PurchaseDate===new Date().toISOString().split('T')[0]);
  const todayExpenses=expenses.filter(e=>e.Date===new Date().toISOString().split('T')[0]);
  const todayPTotal=todayPurchases.reduce((s,p)=>s+(parseFloat(p.Price)||0),0);
  const todayETotal=todayExpenses.reduce((s,e)=>s+(parseFloat(e.Amount)||0),0);

  return(
    <div className="min-h-screen bg-gray-100 pb-24">
      {toast&&<div className="fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-xl shadow-lg text-white font-medium fade" style={{background:toast.type==='success'?'#10b981':'#ef4444'}}>{toast.msg}</div>}
      
      <header className="sticky top-0 z-40 p-4 text-white" style={{background:'linear-gradient(135deg,#dc2626,#991b1b)'}}>
        <div className="flex justify-between items-center">
          <div className="flex items-center gap-3">
            <span className="text-3xl">üçú</span>
            <div>
              <h1 className="text-lg font-bold leading-tight">{BRANCH_NAME}</h1>
              <p className="text-xs opacity-75">{BRANCH_CODE} ‚Ä¢ {new Date().toLocaleDateString('en-PH',{weekday:'short',month:'short',day:'numeric'})}</p>
            </div>
          </div>
          <div className="flex items-center gap-2">
            {loading&&<div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full spin"/>}
            <button onClick={()=>{loadAll();loadTx(viewDays)}} className="p-2 rounded-lg hover:bg-white/20 text-xl">üîÑ</button>
            <button onClick={logout} className="p-2 rounded-lg hover:bg-white/20 text-sm">üö™</button>
          </div>
        </div>
        
        <div className="grid grid-cols-2 gap-3 mt-4">
          <div className="bg-white/20 rounded-xl p-3">
            <p className="text-white/70 text-xs">Today's Purchases</p>
            <p className="text-xl font-bold">{fmt(todayPTotal)}</p>
            <p className="text-xs text-white/60">{todayPurchases.length} items</p>
          </div>
          <div className="bg-white/20 rounded-xl p-3">
            <p className="text-white/70 text-xs">Today's Expenses</p>
            <p className="text-xl font-bold">{fmt(todayETotal)}</p>
            <p className="text-xs text-white/60">{todayExpenses.length} items</p>
          </div>
        </div>
      </header>

      <main className="p-4">
        {tab==='purchases'&&<Purchases apiUrl={apiUrl} settings={settings} purchases={purchases} showToast={showToast} loadTx={()=>loadTx(viewDays)} ingredients={ingredients} viewDays={viewDays} setViewDays={setViewDays}/>}
        {tab==='expenses'&&<Expenses apiUrl={apiUrl} settings={settings} expenses={expenses} showToast={showToast} loadTx={()=>loadTx(viewDays)} viewDays={viewDays} setViewDays={setViewDays}/>}
        {tab==='ingredients'&&<Ingredients apiUrl={apiUrl} ingredients={ingredients} ingCats={ingCats} settings={settings} showToast={showToast} loadAll={loadAll}/>}
      </main>

      <nav className="fixed bottom-0 left-0 right-0 bg-white border-t flex z-40">
        {[
          {id:'purchases',icon:'üõí',label:'Purchases'},
          {id:'expenses',icon:'üí∞',label:'Expenses'},
          {id:'ingredients',icon:'ü•¨',label:'Ingredients'}
        ].map(t=>
          <button key={t.id} onClick={()=>setTab(t.id)} className={`flex-1 py-4 text-center ${tab===t.id?'text-red-600 bg-red-50':'text-gray-500'}`}>
            <span className="text-2xl block">{t.icon}</span>
            <span className="text-xs font-medium">{t.label}</span>
          </button>
        )}
      </nav>
    </div>
  );
}


function Purchases({apiUrl,settings,purchases,showToast,loadTx,ingredients,viewDays,setViewDays}){
  const[saving,setSaving]=useState(false);
  const[uploading,setUploading]=useState(false);
  
  // Header info (shared by all items in this PO)
  const[header,setHeader]=useState({
    PurchaseDate:new Date().toISOString().split('T')[0],
    Supplier:'',
    PO:'',
    PayMethod:'Cash',
    InvoicePhoto:''
  });
  
  // Current item being entered
  const[item,setItem]=useState({ItemName:'',MasterSKU:'',BaseUnit:'g',Description:'',ContainerType:'',ContainerSize:'',ContainerUnit:'kg',Qty:'',Price:'',Notes:''});
  
  // Temporary posted items (not yet saved to server)
  const[postedItems,setPostedItems]=useState([]);
  
  const[search,setSearch]=useState('');
  const[showSearch,setShowSearch]=useState(false);
  const[photoPreview,setPhotoPreview]=useState(null);
  const[viewPhoto,setViewPhoto]=useState(null);

  // Select ingredient from search
  const selectIngredient=(ing)=>{
    setItem({
      ...item,
      ItemName:ing.Name,
      MasterSKU:ing.MasterSKU,
      BaseUnit:ing.Unit||'g',
      ContainerType:ing.ContainerType||'',
      ContainerSize:ing.ContainerSize||'',
      ContainerUnit:ing.ContainerUnit||ing.Unit||'kg'
    });
    setSearch('');
    setShowSearch(false);
  };

  // Photo handling
  const handlePhoto=async(e)=>{
    const file=e.target.files?.[0];
    if(!file)return;
    
    const reader=new FileReader();
    reader.onload=(ev)=>setPhotoPreview(ev.target.result);
    reader.readAsDataURL(file);
    
    setUploading(true);
    try{
      const base64=await new Promise((resolve)=>{
        const r=new FileReader();
        r.onload=(ev)=>resolve(ev.target.result);
        r.readAsDataURL(file);
      });
      
      const filename=BRANCH_CODE+'_'+header.PurchaseDate+'_'+Date.now()+'.jpg';
      const result=await api(apiUrl,'uploadInvoicePhoto',{base64,filename,branchCode:BRANCH_CODE});
      
      if(result.success){
        setHeader({...header,InvoicePhoto:result.viewUrl});
        showToast('Photo uploaded!');
      }else{
        showToast(result.error||'Upload failed','error');
      }
    }catch(err){
      showToast('Upload failed: '+err.message,'error');
    }finally{
      setUploading(false);
    }
  };

  // Calculate unit price (per base unit)
  const calcUnitPrice=(itm)=>{
    const price=parseFloat(itm.Price)||0;
    const qty=parseFloat(itm.Qty)||0;
    const containerSize=parseFloat(itm.ContainerSize)||0;
    if(price===0||qty===0)return 0;
    
    let totalBase=qty;
    const cu=(itm.ContainerUnit||'g').toLowerCase();
    const bu=(itm.BaseUnit||'g').toLowerCase();
    
    if(containerSize>0){
      let containerInBase=containerSize;
      if(cu==='kg'&&bu==='g')containerInBase=containerSize*1000;
      else if(cu==='l'&&bu==='ml')containerInBase=containerSize*1000;
      totalBase=qty*containerInBase;
    }else{
      if(cu==='kg'&&bu==='g')totalBase=qty*1000;
      else if(cu==='l'&&bu==='ml')totalBase=qty*1000;
    }
    
    return totalBase>0?(price/totalBase):0;
  };

  // Post item to temporary list
  const postItem=()=>{
    if(!item.ItemName){showToast('Select an ingredient','error');return}
    if(!item.Qty){showToast('Enter quantity','error');return}
    if(!item.Price){showToast('Enter price','error');return}
    
    const qty=parseFloat(item.Qty)||0;
    const pricePerUnit=parseFloat(item.Price)||0;
    const extTotal=qty*pricePerUnit;  // Qty √ó Price per container
    
    const newItem={
      ...item,
      id:Date.now(),
      pricePerUnit:pricePerUnit,
      extTotal:extTotal,
      unitPrice:calcUnitPrice({...item,Price:extTotal})  // Pass total for unit price calc
    };
    
    setPostedItems([...postedItems,newItem]);
    setItem({ItemName:'',MasterSKU:'',BaseUnit:'g',Description:'',ContainerType:'',ContainerSize:'',ContainerUnit:'kg',Qty:'',Price:'',Notes:''});
    showToast('Item posted!');
  };

  // Remove item from temp list
  const removePosted=(id)=>{
    setPostedItems(postedItems.filter(p=>p.id!==id));
  };

  // Clear all posted items
  const clearAll=()=>{
    if(postedItems.length===0)return;
    if(confirm('Clear all posted items?')){
      setPostedItems([]);
    }
  };

  // Save all items to server
  const saveAll=async()=>{
    if(postedItems.length===0){showToast('No items to save','error');return}
    
    setSaving(true);
    try{
      await api(apiUrl,'addPurchases',{data:postedItems.map(p=>({
        ItemName:p.ItemName,
        MasterSKU:p.MasterSKU,
        BaseUnit:p.BaseUnit,
        Description:p.Description,
        ContainerType:p.ContainerType,
        ContainerSize:p.ContainerSize,
        ContainerUnit:p.ContainerUnit,
        Qty:p.Qty,
        Price:p.extTotal,  // Send total price (Qty √ó Price per unit)
        Notes:p.Notes,
        Branch:BRANCH_NAME,
        BranchCode:BRANCH_CODE,
        PurchaseDate:header.PurchaseDate,
        Supplier:header.Supplier,
        PO:header.PO,
        InvoicePhoto:header.InvoicePhoto
      }))});
      
      showToast('Saved '+postedItems.length+' items!');
      setPostedItems([]);
      setPhotoPreview(null);
      setHeader({...header,Supplier:'',PO:'',InvoicePhoto:''});
      loadTx();
    }catch(e){showToast(e.message,'error')}finally{setSaving(false)}
  };

  const poTotal=postedItems.reduce((s,p)=>s+(parseFloat(p.extTotal)||0),0);
  const containerTypes=(settings.ContainerTypes||'Sack,Bottle,Can,Box,Pack,Drum,Bag,Tray,Loose').split(',');
  const containerUnits=(settings.ContainerUnits||'kg,g,L,ml,pcs').split(',');
  const payMethods=(settings.PaymentMethods||'Cash,GCash,Maya,Bank Transfer,Credit').split(',');
  const filteredIng=ingredients.filter(ing=>ing.Name?.toLowerCase().includes(search.toLowerCase()));

  return(
    <div className="space-y-4 fade">
      {/* Photo viewer modal */}
      {viewPhoto&&<div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4" onClick={()=>setViewPhoto(null)}>
        <div className="max-w-lg w-full">
          <img src={viewPhoto} alt="Invoice" className="w-full rounded-lg"/>
          <p className="text-center text-white mt-2 text-sm">Tap to close</p>
        </div>
      </div>}

      <div className="flex justify-between items-center">
        <h2 className="text-lg font-bold text-gray-800">üõí Purchase Entry</h2>
      </div>

      {/* === HEADER SECTION === */}
      <div className="card p-4 space-y-3 bg-gradient-to-r from-red-800 to-red-700 text-white">
        <div className="grid grid-cols-2 gap-3">
          <div>
            <label className="text-xs text-red-200">Date</label>
            <input type="date" value={header.PurchaseDate} onChange={e=>setHeader({...header,PurchaseDate:e.target.value})} className="inp bg-white/20 border-white/30 text-white"/>
          </div>
          <div>
            <label className="text-xs text-red-200">Vendor</label>
            <input value={header.Supplier} onChange={e=>setHeader({...header,Supplier:e.target.value})} className="inp bg-white/20 border-white/30 text-white placeholder-white/50" placeholder="Supplier name"/>
          </div>
        </div>
        <div className="grid grid-cols-2 gap-3">
          <div>
            <label className="text-xs text-red-200">P.O. #</label>
            <input value={header.PO} onChange={e=>setHeader({...header,PO:e.target.value})} className="inp bg-white/20 border-white/30 text-white placeholder-white/50" placeholder="Optional"/>
          </div>
          <div>
            <label className="text-xs text-red-200">Pay Method</label>
            <select value={header.PayMethod} onChange={e=>setHeader({...header,PayMethod:e.target.value})} className="inp bg-white/20 border-white/30 text-white">
              {payMethods.map(m=><option key={m} value={m.trim()} className="text-black">{m.trim()}</option>)}
            </select>
          </div>
        </div>
        
        {/* Invoice Photo */}
        <div>
          <label className="text-xs text-red-200">üì∑ Invoice Photo</label>
          {photoPreview||header.InvoicePhoto?(
            <div className="relative mt-1">
              <img src={photoPreview||header.InvoicePhoto} alt="Invoice" className="w-full h-24 object-cover rounded-lg"/>
              <button onClick={()=>{setPhotoPreview(null);setHeader({...header,InvoicePhoto:''})}} className="absolute top-1 right-1 bg-black/50 text-white w-6 h-6 rounded-full text-xs">‚úï</button>
              {uploading&&<div className="absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg"><div className="w-6 h-6 border-2 border-white/30 border-t-white rounded-full spin"/></div>}
            </div>
          ):(
            <label className="block border-2 border-dashed border-white/30 rounded-lg p-3 text-center cursor-pointer hover:border-white/50 mt-1">
              <input type="file" accept="image/*" capture="environment" onChange={handlePhoto} className="hidden"/>
              <span className="text-2xl">üì∑</span>
              <span className="text-xs block text-red-200">Tap to capture</span>
            </label>
          )}
        </div>

        {/* P.O. Total */}
        <div className="bg-yellow-500 text-black rounded-lg p-3 flex justify-between items-center">
          <span className="font-bold">P.O. Total:</span>
          <span className="text-2xl font-bold">‚Ç± {poTotal.toLocaleString('en-PH',{minimumFractionDigits:2})}</span>
        </div>
      </div>

      {/* === ITEM ENTRY SECTION === */}
      <div className="card p-4 space-y-3">
        <h3 className="font-bold text-gray-700 border-b pb-2">Item Entry</h3>
        
        {/* Item Name with Search */}
        <div className="grid grid-cols-3 gap-2">
          <div className="col-span-2 relative">
            <label className="text-xs text-gray-500">Item Name</label>
            <input 
              value={item.ItemName} 
              onChange={e=>{setItem({...item,ItemName:e.target.value});setSearch(e.target.value);setShowSearch(true)}}
              onFocus={()=>setShowSearch(true)}
              onBlur={()=>setTimeout(()=>setShowSearch(false),200)}
              className="inp" 
              placeholder="Search ingredient..."
            />
            {showSearch&&search&&filteredIng.length>0&&(
              <div className="absolute top-full left-0 right-0 bg-white border rounded-lg shadow-lg z-20 max-h-48 overflow-y-auto">
                {filteredIng.slice(0,10).map(ing=>
                  <button key={ing.MasterSKU} onMouseDown={()=>selectIngredient(ing)} className="w-full p-2 text-left hover:bg-red-50 text-sm border-b">
                    <span className="font-medium">{ing.Name}</span>
                    {ing.ContainerType&&<span className="text-gray-400 text-xs ml-2">({ing.ContainerType} {ing.ContainerSize}{ing.ContainerUnit})</span>}
                  </button>
                )}
              </div>
            )}
          </div>
          <div>
            <label className="text-xs text-gray-500">Code</label>
            <input value={item.MasterSKU} readOnly className="inp bg-gray-100 text-gray-500" placeholder="Auto"/>
          </div>
        </div>

        <div>
          <label className="text-xs text-gray-500">Description / Notes</label>
          <input value={item.Description} onChange={e=>setItem({...item,Description:e.target.value})} className="inp" placeholder="Optional details"/>
        </div>

        <div className="grid grid-cols-4 gap-2">
          <div>
            <label className="text-xs text-gray-500">QTY</label>
            <input type="number" value={item.Qty} onChange={e=>setItem({...item,Qty:e.target.value})} className="inp text-center font-bold" placeholder="0"/>
          </div>
          <div>
            <label className="text-xs text-gray-500">Container</label>
            <select value={item.ContainerType} onChange={e=>setItem({...item,ContainerType:e.target.value})} className="inp text-sm">
              <option value="">(None)</option>
              {containerTypes.map(c=><option key={c} value={c.trim()}>{c.trim()}</option>)}
            </select>
          </div>
          <div>
            <label className="text-xs text-gray-500">Size</label>
            <input type="number" value={item.ContainerSize} onChange={e=>setItem({...item,ContainerSize:e.target.value})} className="inp text-center" placeholder="0" step="0.1"/>
          </div>
          <div>
            <label className="text-xs text-gray-500">Unit</label>
            <select value={item.ContainerUnit} onChange={e=>setItem({...item,ContainerUnit:e.target.value})} className="inp text-sm">
              {containerUnits.map(u=><option key={u} value={u.trim()}>{u.trim()}</option>)}
            </select>
          </div>
        </div>

        <div className="grid grid-cols-2 gap-2">
          <div>
            <label className="text-xs text-gray-500">Price /: (per {item.ContainerType||'unit'})</label>
            <div className="relative">
              <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 font-bold">‚Ç±</span>
              <input type="number" value={item.Price} onChange={e=>setItem({...item,Price:e.target.value})} className="inp pl-8 text-lg font-bold" placeholder="0.00" step="0.01"/>
            </div>
          </div>
          <div className="flex items-end">
            <button onClick={postItem} className="btn btn-p w-full py-3 text-lg">
              üì• Post Item
            </button>
          </div>
        </div>

        {/* Ext Total and Unit price preview */}
        {item.Qty&&item.Price&&(
          <div className="text-sm bg-green-50 p-2 rounded-lg space-y-1">
            <div className="flex justify-between text-green-800">
              <span>Ext Total: {item.Qty} √ó ‚Ç±{parseFloat(item.Price).toLocaleString()}</span>
              <span className="font-bold">‚Ç±{(parseFloat(item.Qty)*parseFloat(item.Price)).toLocaleString()}</span>
            </div>
            <div className="text-xs text-green-700 text-center">
              Standardized: ‚Ç±{calcUnitPrice({...item,Price:parseFloat(item.Qty)*parseFloat(item.Price)}).toFixed(4)} per {item.BaseUnit}
            </div>
          </div>
        )}
      </div>

      {/* === POSTED ITEMS TABLE === */}
      <div className="card">
        <div className="p-3 border-b bg-gray-800 text-white flex justify-between items-center rounded-t-xl">
          <span className="font-bold">üìã Posted Items ({postedItems.length})</span>
          <div className="flex gap-2">
            <button onClick={clearAll} disabled={postedItems.length===0} className="px-3 py-1 bg-gray-600 rounded text-sm disabled:opacity-50">Clear All</button>
            <button onClick={saveAll} disabled={saving||postedItems.length===0} className="px-4 py-1 bg-green-600 rounded text-sm font-bold disabled:opacity-50">
              {saving?'Saving...':'üíæ Save All'}
            </button>
          </div>
        </div>
        
        <div className="max-h-64 overflow-y-auto">
          {postedItems.length===0?(
            <p className="p-6 text-center text-gray-400">No items posted yet. Add items above and click "Post Item".</p>
          ):(
            <table className="w-full text-sm">
              <thead className="bg-gray-100 sticky top-0">
                <tr>
                  <th className="p-2 text-left">Item</th>
                  <th className="p-2 text-center">Qty</th>
                  <th className="p-2 text-right">Price/:</th>
                  <th className="p-2 text-right">Ext Total</th>
                  <th className="p-2 w-8"></th>
                </tr>
              </thead>
              <tbody>
                {postedItems.map(p=>
                  <tr key={p.id} className="border-b hover:bg-gray-50">
                    <td className="p-2">
                      <div className="font-medium">{p.ItemName}</div>
                      {p.ContainerType&&<div className="text-xs text-gray-500">{p.ContainerType} ({p.ContainerSize}{p.ContainerUnit})</div>}
                    </td>
                    <td className="p-2 text-center">{p.Qty}</td>
                    <td className="p-2 text-right text-gray-600">{fmt(p.pricePerUnit)}</td>
                    <td className="p-2 text-right font-bold text-red-700">{fmt(p.extTotal)}</td>
                    <td className="p-2">
                      <button onClick={()=>removePosted(p.id)} className="text-red-500 hover:text-red-700">‚úï</button>
                    </td>
                  </tr>
                )}
              </tbody>
              <tfoot className="bg-red-50">
                <tr>
                  <td colSpan="3" className="p-2 font-bold text-right">Total:</td>
                  <td className="p-2 text-right font-bold text-red-700 text-lg">{fmt(poTotal)}</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          )}
        </div>
      </div>

      {/* === RECENT PURCHASES (Already Saved) === */}
      <div className="card">
        <div className="p-3 border-b bg-gray-50 flex justify-between items-center">
          <span className="font-semibold text-gray-700">üìú Saved Purchases</span>
          <div className="flex items-center gap-2">
            <span className="text-sm text-gray-500">{purchases.length} items</span>
            <select value={viewDays} onChange={e=>setViewDays(parseInt(e.target.value))} className="text-sm border rounded-lg px-2 py-1 bg-white">
              <option value="0">Today</option>
              <option value="7">7 Days</option>
              <option value="30">30 Days</option>
            </select>
          </div>
        </div>
        <div className="max-h-64 overflow-y-auto">
          {purchases.length===0?<p className="p-6 text-center text-gray-400">{viewDays===0?'No purchases saved today':'No purchases'}</p>:
            purchases.slice(0,30).map(p=>
              <div key={p.UniqueID} className="p-3 border-b flex items-center">
                {p.InvoicePhoto&&<button onClick={()=>setViewPhoto(p.InvoicePhoto)} className="w-10 h-10 rounded-lg overflow-hidden mr-3 flex-shrink-0 bg-gray-200">
                  <img src={p.InvoicePhoto} alt="" className="w-full h-full object-cover"/>
                </button>}
                <div className="flex-1 min-w-0">
                  <p className="font-medium text-sm">{p.ItemName}</p>
                  <p className="text-xs text-gray-500">{p.Qty} {p.ContainerType||p.Unit}{p.WeightPerContainer?' ('+p.WeightPerContainer+')':''} ‚Ä¢ {p.Supplier||'No vendor'}</p>
                </div>
                <span className="font-bold text-red-700">{fmt(p.Price)}</span>
              </div>
            )}
        </div>
      </div>
    </div>
  );
}

function Expenses({apiUrl,settings,expenses,showToast,loadTx,viewDays,setViewDays}){
  const[saving,setSaving]=useState(false);
  const[uploading,setUploading]=useState(false);
  
  // Header info (shared by all items)
  const[header,setHeader]=useState({
    Date:new Date().toISOString().split('T')[0],
    Vendor:'',
    Reference:'',
    PayMethod:'Cash',
    ReceiptPhoto:''
  });
  
  // Current item being entered
  const[item,setItem]=useState({Category:'Utilities',Description:'',Amount:''});
  
  // Temporary posted items (not yet saved to server)
  const[postedItems,setPostedItems]=useState([]);
  
  const[photoPreview,setPhotoPreview]=useState(null);
  const[viewPhoto,setViewPhoto]=useState(null);

  // Photo handling
  const handlePhoto=async(e)=>{
    const file=e.target.files?.[0];
    if(!file)return;
    
    const reader=new FileReader();
    reader.onload=(ev)=>setPhotoPreview(ev.target.result);
    reader.readAsDataURL(file);
    
    setUploading(true);
    try{
      const base64=await new Promise((resolve)=>{
        const r=new FileReader();
        r.onload=(ev)=>resolve(ev.target.result);
        r.readAsDataURL(file);
      });
      
      const filename=BRANCH_CODE+'_EXP_'+header.Date+'_'+Date.now()+'.jpg';
      const result=await api(apiUrl,'uploadReceiptPhoto',{base64,filename,branchCode:BRANCH_CODE});
      
      if(result.success){
        setHeader({...header,ReceiptPhoto:result.viewUrl});
        showToast('Photo uploaded!');
      }else{
        showToast(result.error||'Upload failed','error');
      }
    }catch(err){
      showToast('Upload failed: '+err.message,'error');
    }finally{
      setUploading(false);
    }
  };

  // Post item to temporary list
  const postItem=()=>{
    if(!item.Description){showToast('Enter description','error');return}
    if(!item.Amount){showToast('Enter amount','error');return}
    
    const newItem={
      ...item,
      id:Date.now(),
      amount:parseFloat(item.Amount)||0
    };
    
    setPostedItems([...postedItems,newItem]);
    setItem({Category:item.Category,Description:'',Amount:''});
    showToast('Item posted!');
  };

  // Remove item from temp list
  const removePosted=(id)=>{
    setPostedItems(postedItems.filter(p=>p.id!==id));
  };

  // Clear all posted items
  const clearAll=()=>{
    if(postedItems.length===0)return;
    if(confirm('Clear all posted items?')){
      setPostedItems([]);
    }
  };

  // Save all items to server
  const saveAll=async()=>{
    if(postedItems.length===0){showToast('No items to save','error');return}
    
    setSaving(true);
    try{
      await api(apiUrl,'addExpenses',{data:postedItems.map(p=>({
        Category:p.Category,
        Description:p.Description,
        Amount:p.amount,
        Branch:BRANCH_NAME,
        BranchCode:BRANCH_CODE,
        Date:header.Date,
        Vendor:header.Vendor,
        Reference:header.Reference,
        PayMethod:header.PayMethod,
        ReceiptPhoto:header.ReceiptPhoto
      }))});
      
      showToast('Saved '+postedItems.length+' items!');
      setPostedItems([]);
      setPhotoPreview(null);
      setHeader({...header,Vendor:'',Reference:'',ReceiptPhoto:''});
      loadTx();
    }catch(e){showToast(e.message,'error')}finally{setSaving(false)}
  };

  const totalAmount=postedItems.reduce((s,p)=>s+(p.amount||0),0);
  const categories=(settings.ExpenseCategories||'Utilities,Supplies,Maintenance,Transportation,Labor,Marketing,Rent,Other').split(',');
  const payMethods=(settings.PaymentMethods||'Cash,GCash,Maya,Bank Transfer').split(',');

  return(
    <div className="space-y-4 fade">
      {/* Photo viewer modal */}
      {viewPhoto&&<div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4" onClick={()=>setViewPhoto(null)}>
        <div className="max-w-lg w-full">
          <img src={viewPhoto} alt="Receipt" className="w-full rounded-lg"/>
          <p className="text-center text-white mt-2 text-sm">Tap to close</p>
        </div>
      </div>}

      <div className="flex justify-between items-center">
        <h2 className="text-lg font-bold text-gray-800">üí∞ Expense Entry</h2>
      </div>

      {/* === HEADER SECTION === */}
      <div className="card p-4 space-y-3 bg-gradient-to-r from-amber-700 to-amber-600 text-white">
        <div className="grid grid-cols-2 gap-3">
          <div>
            <label className="text-xs text-amber-200">Date</label>
            <input type="date" value={header.Date} onChange={e=>setHeader({...header,Date:e.target.value})} className="inp bg-white/20 border-white/30 text-white"/>
          </div>
          <div>
            <label className="text-xs text-amber-200">Vendor</label>
            <input value={header.Vendor} onChange={e=>setHeader({...header,Vendor:e.target.value})} className="inp bg-white/20 border-white/30 text-white placeholder-white/50" placeholder="Optional"/>
          </div>
        </div>
        <div className="grid grid-cols-2 gap-3">
          <div>
            <label className="text-xs text-amber-200">Reference #</label>
            <input value={header.Reference} onChange={e=>setHeader({...header,Reference:e.target.value})} className="inp bg-white/20 border-white/30 text-white placeholder-white/50" placeholder="Optional"/>
          </div>
          <div>
            <label className="text-xs text-amber-200">Pay Method</label>
            <select value={header.PayMethod} onChange={e=>setHeader({...header,PayMethod:e.target.value})} className="inp bg-white/20 border-white/30 text-white">
              {payMethods.map(m=><option key={m} value={m.trim()} className="text-black">{m.trim()}</option>)}
            </select>
          </div>
        </div>
        
        {/* Receipt Photo */}
        <div>
          <label className="text-xs text-amber-200">üßæ Receipt Photo</label>
          {photoPreview||header.ReceiptPhoto?(
            <div className="relative mt-1">
              <img src={photoPreview||header.ReceiptPhoto} alt="Receipt" className="w-full h-24 object-cover rounded-lg"/>
              <button onClick={()=>{setPhotoPreview(null);setHeader({...header,ReceiptPhoto:''})}} className="absolute top-1 right-1 bg-black/50 text-white w-6 h-6 rounded-full text-xs">‚úï</button>
              {uploading&&<div className="absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg"><div className="w-6 h-6 border-2 border-white/30 border-t-white rounded-full spin"/></div>}
            </div>
          ):(
            <label className="block border-2 border-dashed border-white/30 rounded-lg p-3 text-center cursor-pointer hover:border-white/50 mt-1">
              <input type="file" accept="image/*" capture="environment" onChange={handlePhoto} className="hidden"/>
              <span className="text-2xl">üßæ</span>
              <span className="text-xs block text-amber-200">Tap to capture</span>
            </label>
          )}
        </div>

        {/* Total */}
        <div className="bg-yellow-500 text-black rounded-lg p-3 flex justify-between items-center">
          <span className="font-bold">Total:</span>
          <span className="text-2xl font-bold">‚Ç± {totalAmount.toLocaleString('en-PH',{minimumFractionDigits:2})}</span>
        </div>
      </div>

      {/* === ITEM ENTRY SECTION === */}
      <div className="card p-4 space-y-3">
        <h3 className="font-bold text-gray-700 border-b pb-2">Expense Item</h3>
        
        <div className="grid grid-cols-2 gap-2">
          <div>
            <label className="text-xs text-gray-500">Category</label>
            <select value={item.Category} onChange={e=>setItem({...item,Category:e.target.value})} className="inp">
              {categories.map(c=><option key={c} value={c.trim()}>{c.trim()}</option>)}
            </select>
          </div>
          <div>
            <label className="text-xs text-gray-500">Amount</label>
            <div className="relative">
              <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 font-bold">‚Ç±</span>
              <input type="number" value={item.Amount} onChange={e=>setItem({...item,Amount:e.target.value})} className="inp pl-8 font-bold" placeholder="0.00" step="0.01"/>
            </div>
          </div>
        </div>

        <div>
          <label className="text-xs text-gray-500">Description *</label>
          <input value={item.Description} onChange={e=>setItem({...item,Description:e.target.value})} className="inp" placeholder="What was this expense for?"/>
        </div>

        <button onClick={postItem} className="btn btn-p w-full py-3 text-lg">
          üì• Post Item
        </button>
      </div>

      {/* === POSTED ITEMS TABLE === */}
      <div className="card">
        <div className="p-3 border-b bg-gray-800 text-white flex justify-between items-center rounded-t-xl">
          <span className="font-bold">üìã Posted Items ({postedItems.length})</span>
          <div className="flex gap-2">
            <button onClick={clearAll} disabled={postedItems.length===0} className="px-3 py-1 bg-gray-600 rounded text-sm disabled:opacity-50">Clear All</button>
            <button onClick={saveAll} disabled={saving||postedItems.length===0} className="px-4 py-1 bg-green-600 rounded text-sm font-bold disabled:opacity-50">
              {saving?'Saving...':'üíæ Save All'}
            </button>
          </div>
        </div>
        
        <div className="max-h-64 overflow-y-auto">
          {postedItems.length===0?(
            <p className="p-6 text-center text-gray-400">No items posted yet. Add items above and click "Post Item".</p>
          ):(
            <table className="w-full text-sm">
              <thead className="bg-gray-100 sticky top-0">
                <tr>
                  <th className="p-2 text-left">Description</th>
                  <th className="p-2 text-left">Category</th>
                  <th className="p-2 text-right">Amount</th>
                  <th className="p-2 w-8"></th>
                </tr>
              </thead>
              <tbody>
                {postedItems.map(p=>
                  <tr key={p.id} className="border-b hover:bg-gray-50">
                    <td className="p-2 font-medium">{p.Description}</td>
                    <td className="p-2 text-gray-500 text-xs">{p.Category}</td>
                    <td className="p-2 text-right font-bold text-amber-700">{fmt(p.amount)}</td>
                    <td className="p-2">
                      <button onClick={()=>removePosted(p.id)} className="text-red-500 hover:text-red-700">‚úï</button>
                    </td>
                  </tr>
                )}
              </tbody>
              <tfoot className="bg-amber-50">
                <tr>
                  <td colSpan="2" className="p-2 font-bold text-right">Total:</td>
                  <td className="p-2 text-right font-bold text-amber-700 text-lg">{fmt(totalAmount)}</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          )}
        </div>
      </div>

      {/* === RECENT EXPENSES (Already Saved) === */}
      <div className="card">
        <div className="p-3 border-b bg-gray-50 flex justify-between items-center">
          <span className="font-semibold text-gray-700">üìú Saved Expenses</span>
          <div className="flex items-center gap-2">
            <span className="text-sm text-gray-500">{expenses.length} items</span>
            <select value={viewDays} onChange={e=>setViewDays(parseInt(e.target.value))} className="text-sm border rounded-lg px-2 py-1 bg-white">
              <option value="0">Today</option>
              <option value="7">7 Days</option>
              <option value="30">30 Days</option>
            </select>
          </div>
        </div>
        <div className="max-h-64 overflow-y-auto">
          {expenses.length===0?<p className="p-6 text-center text-gray-400">{viewDays===0?'No expenses saved today':'No expenses'}</p>:
            expenses.slice(0,30).map(e=>
              <div key={e.UniqueID} className="p-3 border-b flex items-center">
                {e.ReceiptPhoto&&<button onClick={()=>setViewPhoto(e.ReceiptPhoto)} className="w-10 h-10 rounded-lg overflow-hidden mr-3 flex-shrink-0 bg-gray-200">
                  <img src={e.ReceiptPhoto} alt="" className="w-full h-full object-cover"/>
                </button>}
                <div className="flex-1 min-w-0">
                  <p className="font-medium text-sm">{e.Description}</p>
                  <p className="text-xs text-gray-500">{e.Category} ‚Ä¢ {e.Vendor||'No vendor'}</p>
                </div>
                <span className="font-bold text-amber-600">{fmt(e.Amount)}</span>
              </div>
            )}
        </div>
      </div>
    </div>
  );
}

function Ingredients({apiUrl,ingredients,ingCats,settings,showToast,loadAll}){
  const[show,setShow]=useState(false);
  const[saving,setSaving]=useState(false);
  const[search,setSearch]=useState('');
  const[form,setForm]=useState({Name:'',Unit:'g',Category:'Other',YieldPercent:100});

  const add=async()=>{
    if(!form.Name){showToast('Enter name','error');return}
    setSaving(true);
    try{
      await api(apiUrl,'addIngredient',{data:form});
      showToast('Added!');
      setForm({Name:'',Unit:'g',Category:'Other',YieldPercent:100});
      setShow(false);
      loadAll();
    }catch(e){showToast(e.message,'error')}finally{setSaving(false)}
  };

  const filtered=ingredients.filter(i=>i.Name?.toLowerCase().includes(search.toLowerCase()));
  const units=(settings.Units||'g,kg,ml,L,pcs,pack,box').split(',');

  return(
    <div className="space-y-4 fade">
      <div className="flex justify-between items-center">
        <h2 className="text-lg font-bold text-gray-800">ü•¨ Ingredients</h2>
        <button onClick={()=>setShow(!show)} className="btn btn-p btn-sm">{show?'‚úï Cancel':'+ Add New'}</button>
      </div>

      {show&&<div className="card p-4 fade space-y-3">
        <div><label className="lbl">Name *</label><input value={form.Name} onChange={e=>setForm({...form,Name:e.target.value})} className="inp" placeholder="e.g., Chicken Breast"/></div>
        <div className="grid grid-cols-2 gap-3">
          <div><label className="lbl">Unit</label><select value={form.Unit} onChange={e=>setForm({...form,Unit:e.target.value})} className="inp">{units.map(u=><option key={u} value={u.trim()}>{u.trim()}</option>)}</select></div>
          <div><label className="lbl">Category</label><select value={form.Category} onChange={e=>setForm({...form,Category:e.target.value})} className="inp">{ingCats.map(c=><option key={c.Category}>{c.Category}</option>)}</select></div>
        </div>
        <button onClick={add} disabled={saving} className="btn btn-p w-full">
          {saving?'Saving...':'‚úì Add Ingredient'}
        </button>
      </div>}

      <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="üîç Search ingredients..." className="inp"/>
      
      <div className="card">
        <div className="p-3 border-b bg-gray-50">
          <span className="font-semibold text-gray-700">{filtered.length} ingredients</span>
        </div>
        <div className="max-h-96 overflow-y-auto">
          {filtered.length===0?<p className="p-8 text-center text-gray-400">No ingredients found</p>:
            filtered.map(ing=>
              <div key={ing.MasterSKU} className="p-3 border-b">
                <p className="font-medium">{ing.Name}</p>
                <p className="text-xs text-gray-500">SKU: {ing.MasterSKU} ‚Ä¢ {ing.Unit} ‚Ä¢ {ing.Category}</p>
              </div>
            )}
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
